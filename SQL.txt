Q1.Display top 5 highest salary earners in each dept

->SELECT dept_name, emp_name, salary FROM (SELECT e.emp_name,e.salary,d.dept_name,ROW_NUMBER() OVER (PARTITION BY e.dept_id ORDER BY e.salary DESC) as rank FROM employees e JOIN departments d ON e.dept_id = d.dept_id) ranked_employees WHERE rank <= 5 ORDER BY dept_name, rank;

Q2. Write a stored function getWorkingDays which accepts joining data and returns
the no of working days

->
DELIMITER $
CREATE FUNCTION getWorkingDays(joining_date DATE) 
RETURNS INT
DETERMINISTIC
READS SQL DATA
BEGIN
    DECLARE total_days INT;
    DECLARE working_days INT DEFAULT 0;
    DECLARE current_date DATE;
    DECLARE end_date DATE;
    
    SET end_date = CURDATE();
    SET current_date = joining_date;
    
    WHILE current_date <= end_date DO
        IF DAYOFWEEK(current_date) NOT IN (1, 7) THEN
            SET working_days = working_days + 1;
        END IF;
        SET current_date = DATE_ADD(current_date, INTERVAL 1 DAY);
    END WHILE;
    
    RETURN working_days;
END $

DELIMITER ;

Q3.Write a stored procedure which updates the salary of a given emp based on no
of working days. Give differential salary rise based on no of working days.

->DELIMITER $

CREATE FUNCTION getWorkingDays(joining_date DATE) 
RETURNS INT
DETERMINIC
READS SQL DATA
BEGIN
    DECLARE total_days INT;
    DECLARE working_days INT DEFAULT 0;
    DECLARE current_date DATE;
    DECLARE end_date DATE;
    
    SET end_date = CURDATE();
    SET current_date = joining_date;
    
    DROP TEMPORARY TABLE IF EXISTS temp_holidays;
    CREATE TEMPORARY TABLE temp_holidays (
        holiday_date DATE
    );
    
    INSERT INTO temp_holidays VALUES 
    ('2024-01-01'),
    ('2024-12-25');
    
    WHILE current_date <= end_date DO
        IF DAYOFWEEK(current_date) NOT IN (1, 7) 
           AND NOT EXISTS (SELECT 1 FROM temp_holidays WHERE holiday_date = current_date) THEN
            SET working_days = working_days + 1;
        END IF;
        SET current_date = DATE_ADD(current_date, INTERVAL 1 DAY);
    END WHILE;
    
    RETURN working_days;
END $

DELIMITER ;
